---
title: "BellaBeat Case Study"
date: "`r Sys.Date()`"
author: "Akash Sapariya"
output:
  rmarkdown::html_document:
    theme: paper
    toc: yes
    number_sections: yes
    highlight: tango
---
***
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```  
***

# About the Company

Bellabeat, a high-tech manufacturer of health-focused products for women. Bellabeat is a successful small company, but they have the potential to become a larger player in the global smart device market. Urška Sršen, cofounder and Chief Creative Officer of Bellabeat, believes that analyzing smart device fitness data could help unlock new growth opportunities for the company

![](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRFoQPNBtZytMqV0NFOItlkpuGHiAe31B_Fig&usqp=CAU)

***
# Ask Phase

## Business Questions

*  What are some trends in smart device usage? 
*  How could these trends apply to Bellabeat customers?
*  How could these trends help influence Bellabeat marketing strategy? 

## Business Task

How consumers use non-Bellabeat smart devices to gain insight

### Stakeholders

*  Urška Sršen - Bellabeat cofounder and Chief Creative Officer
*  Sando Mur - Bellabeat cofounder and key member of Bellabeat executive team
*  Bellabeat Marketing Analytics team

***

# Prepare Phase

## Dataset used

For the analysis using the fitbit fitness tracker public data [link](https://www.kaggle.com/datasets/arashnic/fitbit)

![](http://blog.bestbuy.ca/wp-content/uploads/2020/05/Fitbit_Full_Family-e1619635272547.jpg)

## Accessibility and privacy of the data

Verifying the metadata of our dataset we can confirm it is open-source. The owner has dedicated the work to the public domain by waiving all of his or her rights to the work worldwide under copyright law, including all related and neighboring rights, to the extent allowed by law. You can copy, modify, distribute and perform the work, even for commercial purposes, all without asking permission.

## Information about our dataset

These datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.

## Data credibility and integrity

This Kaggle data set contains personal fitness tracker from thirty fitbit users. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. It includes information about daily activity, steps, and heart rate that can be used to explore users’ habits.

***

# Process Phase    

## Installing packages and opening libraries

We will use the following packages for our analysis:

*  tidyverse
*  here
*  skimr
*  janitor
*  lubridate
*  ggplot2
*  ggrepel
*  dplyr
*  tidyr

### Loading Required Libraries and Setting the working directory

```{r}
options(warn=-1)
library(tidyverse)  # Data import and wrangling
library(lubridate)  # Date functions
library(ggplot2)    # For data Visualization
library(dplyr)
library(tidyr)
library(here)
library(skimr)
library(janitor)
library(ggrepel)
library(kableExtra)     # For viewing tables in awesome way
library(scales)         # For transforming numbers in percentage
library(highcharter)    # Interactive graphs
library(RColorBrewer)   # Pallete colors
```

```{r}
getwd()   # Displays the working directory
setwd("../input") #Sets the working directory
```

## Importing the datasets

In the dataset there are 18 csv files. Each of them show data related to the different functions of the device: calories, activity level, daily steps, etc. 

In this study, we will be focusing on daily information to simplify the analysis

#### Daily Activity

```{r message=FALSE}
daily_activity <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
```

#### Daily Calories

```{r message=FALSE}
daily_calories <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/dailyCalories_merged.csv")
```

#### Daily Intensities

```{r message=FALSE}
daily_intensities <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/dailyIntensities_merged.csv")
```

#### Daily Steps

```{r message=FALSE}
daily_steps <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/dailySteps_merged.csv")
```

#### Daily Sleep

```{r message=FALSE}
daily_sleep <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
```

#### Weight

```{r message=FALSE}
weight_info <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
```

## Preview datasets 

#### Daily Activity

```{r}
# Viewing the datasets using the "kableExtra" package
kbl(daily_activity[1:5, ], 'html', caption = 'Table 1: Daily activity') %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>% 
  scroll_box(width = "100%")  # Adding a scroll bar
```

#### Daily Calories 

```{r}
kbl(daily_calories[1:5, ], 'html', caption = 'Table 2: Daily calories') %>% 
kable_styling(bootstrap_options = c("striped", "hover"), 
              full_width = F)
```

#### Daily Steps

```{r}
kbl(daily_steps[1:5, ], 'html', caption = 'Table 3: Daily steps') %>% 
kable_styling(bootstrap_options = c("striped", "hover"), 
              full_width = F)
```

#### Daily Intensities

```{r}
kbl(daily_intensities[1:5, ], 'html', caption = 'Table 4: Daily intensities') %>%  
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  scroll_box(width = "100%")  # Adding a scroll bar
```

#### Daily Sleep

```{r}
kbl(daily_sleep[1:5, ], 'html', caption = 'Table 5: Daily sleep') %>% 
kable_styling(bootstrap_options = c("striped", "hover"), full_width = F)
```

#### Weight

```{r}
kbl(weight_info[1:5, ], 'html', caption = 'Table 6: Weight info') %>% 
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F)
```

## Cleaning and Formatting

After observing the different datsets, it can be concluded thats the table 1 (Daily activity) already contains the information from table 2 (Daily calories), table 3 (Daily steps), table 4 (Daily intensities). Another obervation is that number of observations in each dataset is the same. For that reason, we'll remove those dataframes.

```{r}
rm(daily_calories, daily_intensities, daily_steps)
```

Before merging the datasets, let's clean the date columns to make them homogeneous and transform them to right data type.

```{r}
# Cleaning the variables
daily_activity <- daily_activity %>% 
  rename(Date = ActivityDate) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y"))

daily_sleep <- daily_sleep %>% 
  rename(Date = SleepDay) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y"))

weight_info <- weight_info %>% 
  select(-LogId) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y")) %>% 
  mutate(IsManualReport = as.factor(IsManualReport))
```

## Merging the Datasets

```{r}
final_df <- merge(merge(daily_activity, daily_sleep, by=c('Id','Date'), all = TRUE), weight_info, by = c('Id','Date'), all = TRUE)
```

#### Removing Extra variables

```{r}
final_df <- final_df %>% 
  select(-c(TrackerDistance, LoggedActivitiesDistance, TotalSleepRecords, WeightPounds, Fat, BMI, IsManualReport))
```

#### Viewing the Merged dataframe (final_df) 

```{r}
kbl(final_df[1:5, ], 'html', caption = 'Table 7: Final Dataset') %>% 
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F)
```

#### Checking the variables

```{r}
str(final_df)
```

We can see that majority of the variables are numerical.

```{r}
summary(final_df)
```

***

# Analyze and Share Phase    

## Users Daily Activity 

```{r}
final_df %>% 
  mutate(weekdays = weekdays(Date)) %>% 
  select(weekdays, TotalSteps) %>% 
  mutate(weekdays = factor(weekdays, levels = c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'))) %>% 
  drop_na() %>% 
  ggplot(aes(weekdays, TotalSteps, fill = weekdays)) +
  geom_boxplot() +
  scale_fill_brewer(palette="Set2") +
  theme(legend.position="none") +
  labs(
    title = "Users' activity by day",
    x = "Day of the week",
    y = "Steps",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```

## Calories burned by steps

```{r}
# Calories vs Total Steps
final_df %>% 
  group_by(TotalSteps, Calories) %>% 
  ggplot(aes(x = TotalSteps, y = Calories, color = Calories)) +
  geom_point() +
  geom_smooth() + 
  theme(legend.position = c(.8, .3),
        legend.spacing.y = unit(1, "mm"), 
        panel.border = element_rect(colour = "black", fill=NA),
        legend.background = element_blank(),
        legend.box.background = element_rect(colour = "black")) +
  labs(title = 'Calories burned by total steps taken',
       y = 'Calories',
       x = 'Total Steps',
       caption = 'Data Source: FitBit Fitness Tracker Data')
```

There is a clear positive correlation between these two variables: the more steps taken in a day, the more calories burned. To make sure of this assumption, we can check the correlation between these two variable using the Pearson Correlation Coefficient.

Simply put, the Pearson Correlation Coefficient is a measure of linear correlation between 2 variables. For more information, click [here](https://en.wikipedia.org/wiki/Pearson_correlation_coefficient)

```{r}
cor.test(final_df$TotalSteps, final_df$Calories, method = 'pearson', conf.level = 0.95)
```

With a confidence level of 95%, the correlation between the variables is almost 0.6. This means that there is a strong relationship between the variables.

## Intensity of excercise activity

```{r}
final_df %>% 
  select(VeryActiveDistance, 
         ModeratelyActiveDistance, 
         LightActiveDistance) %>% 
  summarise(across(everything(), list(sum))) %>% 
  gather(activities, value) %>% 
  mutate(ratio = value / sum(value),
         label = percent(ratio %>% round(4))) %>% 
mutate(activities = factor(activities, 
                          labels = c('Light Activity','Moderate Activity', 'Heavy Activity'))) %>% 
  ggplot(aes(x = (activities), 
             y = value, 
             label = label, 
             fill = activities)) +
  geom_bar(stat='identity') +
  geom_label(aes(label = label), 
             fill = "beige", 
             colour = "black",
             vjust = 0.5) +
  scale_fill_brewer(palette="Accent") +
  theme(legend.position="none") +
  labs(
    title = "Intensity of exercise activity",
    x = "Activity level",
    y = "Distance",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```

The most common level of activity during exercise is light.

## Distribution of daily activity

```{r}
# Activity in minutes
final_df %>% 
  select(VeryActiveMinutes, 
         FairlyActiveMinutes, 
         LightlyActiveMinutes, 
         SedentaryMinutes) %>% 
  summarise(across(everything(), list(sum))) %>% 
  gather(active_level, minutes) %>% 
  mutate(active_level = factor(active_level, 
                          labels = c('Moderate Activity','Light Activity',
                                     'Sedentary','Heavy Activity'))) %>% 
  hchart('pie', hcaes(x = active_level, y = minutes)) %>% 
  hc_title(text = "Distribution of daily activity level in minutes",
           style = list(fontFamily = "Helvetica", fontSize = "30px"),
           align = "center") %>% 
  hc_tooltip(pointFormat = "<b>Value:</b> {point.y} <br>
                 <b>Percentage</b> {point.percentage:,.2f}%") %>% 
  hc_credits(
    enabled = TRUE, 
    text = "<em>Data Source: FitBit Fitness Tracker Data</em></span>",
    style = list(fontSize = "12px", color = 'black',type = "spline")
    ) 
```

As expected, we can see that a majority of the day (81.29%) people are sedentary.

## Sleep Distribution

```{r}
# Distribution sleep time
final_df %>% 
  select(TotalMinutesAsleep) %>% 
  drop_na() %>% 
  mutate(sleep_quality = ifelse(TotalMinutesAsleep <= 420, 'Less than 7h',
                         ifelse(TotalMinutesAsleep <= 540, '7h to 9h', 
                         'More than 9h'))) %>%
  mutate(sleep_quality = factor(sleep_quality, 
                          levels = c('Less than 7h','7h to 9h',
                                     'More than 9h'))) %>% 
  ggplot(aes(x = TotalMinutesAsleep, fill = sleep_quality)) +
  geom_histogram(position = 'dodge', bins = 30) +
  scale_fill_manual(values=c("tan1", "#66CC99", "lightcoral")) +
  theme(legend.position = c(.80, .80),
        legend.title = element_blank(),
        legend.spacing.y = unit(0, "mm"), 
        panel.border = element_rect(colour = "black", fill=NA),
        legend.background = element_blank(),
        legend.box.background = element_rect(colour = "black")) +
  labs(
    title = "Sleep distribution",
    x = "Time slept (minutes)",
    y = "Count",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```

In this graph, we can see the users’ average minutes of sleep, following a normal distribution. A majority of users sleep approximately 320 to 530 minutes.

## Sleep Vs Distance covered

```{r}
final_df %>% 
  select(Id, TotalDistance, TotalMinutesAsleep) %>% 
  group_by(Id) %>% 
  summarise_all(list(~mean(., na.rm=TRUE))) %>% 
  drop_na() %>% 
  mutate(Id = factor(Id)) %>% 
  ggplot() +
  geom_bar(aes(x = Id, y = TotalDistance), stat = "identity", fill = 'lightblue', alpha = 0.7) +
  geom_point(aes(x = Id, y = TotalMinutesAsleep/60), color = 'gold4') +
  geom_segment(aes(x = Id, xend = Id, y = 0, yend = TotalMinutesAsleep/60), color = 'gold4' ,group = 1) +
  scale_y_continuous(limits=c(0, 12), name = "Total Distance", 
    sec.axis = sec_axis(~.*60, name = "Sleep in minutes")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(axis.title.y.right = element_text(color = "gold4"), 
        axis.ticks.y.right = element_line(color = "gold4"),
        axis.text.y.right = element_text(color = "gold4")) +
  labs(
    title = "Average distance vs average sleep by user",
    x = "Users",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```

We can observe that covering a greater distance doesn’t necessarily mean that the user is going to have a better sleep (on average).

Let’s confirm this theory with the next graph.

```{r}
final_df %>% 
  select(TotalMinutesAsleep, TotalSteps) %>% 
  mutate(sleep_quality = ifelse(TotalMinutesAsleep <= 420, 'Less than 7h',
                         ifelse(TotalMinutesAsleep <= 540, '7h to 9h', 
                         'More than 9h'))) %>% 
  mutate(active_level = ifelse(TotalSteps >= 15000,'More than 15,000 steps',
                        ifelse(TotalSteps >= 10000,'10,000 to 14,999 steps',
                        ifelse(TotalSteps >= 5000, '5,000 to 9,999 steps',
                        'Less than 4,999 steps')))) %>% 
  select(-c(TotalMinutesAsleep, TotalSteps)) %>% 
  drop_na() %>% 
  group_by(sleep_quality, active_level) %>% 
  summarise(counts = n()) %>% 
  mutate(active_level = factor(active_level, 
                                levels = c('Less than 4,999 steps',
                                           '5,000 to 9,999 steps',
                                           '10,000 to 14,999 steps',
                                           'More than 15,000 steps'))) %>% 
  mutate(sleep_quality = factor(sleep_quality, 
                          levels = c('Less than 7h','7h to 9h',
                                     'More than 9h'))) %>% 
  ggplot(aes(x = sleep_quality, 
             y = counts, 
             fill = sleep_quality)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values=c("tan1", "#66CC99", "lightcoral")) +
  facet_wrap(~active_level, nrow = 1) +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(strip.text = element_text(colour = 'black', size = 8)) +
  theme(strip.background = element_rect(fill = "beige", color = 'black'))+
  labs(
    title = "Sleep quality by steps",
    x = "Sleep quality",
    y = "Count",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```

It seems that on average the best sleep is achieve when the total steps during the day are less than 9,999 steps.

## Users Difficulty to Sleep Vs Steps

```{r}
# Let's see the time they are in bed and don't sleep and let's relate it with their actitity
final_df %>% 
  mutate(no_sleeping = TotalTimeInBed - TotalMinutesAsleep) %>% 
  select(Id, no_sleeping, TotalSteps) %>% 
  group_by(Id) %>% 
  summarise_all(list(~mean(., na.rm=TRUE))) %>%
  drop_na() %>% 
  mutate(Id = factor(Id)) %>% 
  hchart('scatter', hcaes(x = TotalSteps, y = no_sleeping, group = Id, showInLegend = F)) %>% 
  hc_title(text = "Users' dificulty to sleep vs steps taken",
           style = list(fontFamily = "Helvetica", fontSize = "30px"),
           align = "center") %>% 
  hc_legend(enabled = F) %>% 
  hc_yAxis(title = list(text = 'Time in bed not asleep (minutes)')) %>% 
  hc_xAxis(title = list(text = 'Steps taken')) %>% 
  hc_credits(
    enabled = TRUE, 
    text = "<em>Data Source: FitBit Fitness Tracker Data</em></span>",
    style = list(fontSize = "12px", color = 'black',type = "spline")
    ) 
```

We can detect that the majority of users tend to spend around 50 minutes in bed not asleep. However, there are a couple outliers that seem to have insomia.

## Weight Vs Distance covered

```{r}
# Weight vs avg distances
final_df %>% 
  select(Id, WeightKg, TotalDistance) %>% 
  group_by(Id) %>% 
  summarise_all(list(~mean(., na.rm=TRUE))) %>% 
  drop_na() %>% 
  mutate(Id = factor(Id)) %>% 
  ggplot(aes(WeightKg, TotalDistance, fill = Id)) +
  geom_point(aes(color = Id, size = WeightKg), alpha = 0.5) +
  scale_size(range = c(5, 20)) +
  theme(legend.position = "none") +
  labs(
    title = "Weight (kg) vs distance covered",
    x = "Kilograms",
    y = "Total Distance",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )

```

In this sample, we can see that a majority of people are in good shape and are moving more than 5 miles. However, there is one outlier that moves very little and weighs significantly more than the rest.

***

# Act Phase 

*  Calories are burnt by the steps taken daily. Based on user's objectives, Bellabeat could recommend a minimum number of steps for the users to take to encourage them to achieve goals.

*  In order to create a daily habit of exercising for its users, Bellabeat could send a notification at a specific time for the user to remain consistent throughout the week.

*  The data shows that in order to sleep better the best type of exercise is light to moderate (less than 10,000 steps). Bellabeat could recommend this level of exercise for people who want to simply maintain a healthy lifestyle, i.e. don’t perform high-level sports.

*  Studies have shown that a routine before bed can help achieve a better sleep. Bellabeat could send a reminder to start that routine at a certain time and recommend activities to relax and improve sleep.

*  We are aware that some people don't get motivated by notifications so we could create a game on our app for a limited period of time. Game would consist in reaching different levels based on amount of steps walked every day. You need to maintain activity level for a period of time (maybe a month) to pass to the next level. For each level you would win certain amount of stars that would be redeemable for merchandise or discount on other Bellabeat products.

***

Thank You for checking it out, I would like to thank [Miguel Fzzz](https://www.kaggle.com/miguelfzzz) for the contribution in the open source community for helping people refer to case studies to learn and get influenced by the approach.

